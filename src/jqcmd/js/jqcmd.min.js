(function(e){e.fn.jqcmd=function(t){var n=new Array;var r=new Array;var s=-1;var o;var u=this;var a=e.extend({fileSystem:{},hostname:"",style:"black"},t);var f=function(t){t=e.trim(t);r.push(t);if(t.match(/^[^\s-]\.[a-z]+$/)){var n=p();if(n._files[t].hasOwnProperty("location")){window.open(n._files[t].location,"_blank");window.focus()}else{return n._files[t].execute()}}else{params=l(t);command=params.command;try{return h[command].execute(params)}catch(i){console.log(i);parts=t.split(" ");return'That function does not exist. For help and a list of functions, type "help"'}}};var l=function(e){params={};parts=e.split(" ");var t=e.match(/\-([a-z]+)/gi);params.shortform=new Array;for(i in t){t[i]=t[i].slice(1);var n=t[i].split("");params.shortform=params.shortform.concat(n)}e=e.replace(/[\s]*\-[a-z]+[\s]*/gi,"");sections=e.split(" ");params.command=sections.shift();if(sections.length>0){params.target=sections.pop()}return params};var c=function(t){var n=e(t).text().split(" ");if(n.length==0){n=new Array(e(t).text())}var r=n.pop();var s=r.split("/");if(s.length==0){var o=r}else{r=r.split("/");var o=r.pop()}var u=p();for(i in r){u=u[r[i]]}var a=new Array;var f=new Array;for(i in u){a.push(i)}if(u._files){for(i in u._files){a.push(i)}}for(i in a){var l=new RegExp("^"+o,"i");if(a[i].match(l)){f.push(a[i])}}if(f.length==1){if(r.length>0){var c=n.join(" ")+" "+r.join("/")+"/"+f[0]}else{var c=n.join(" ")+" "+f[0]}if(u[f[0]]){c+="/"}e(t).text(c)}};var h={clear:{execute:function(e){u.empty().html(o.clone());return"clearConsole"},help:"clears the screen of all text"},ls:{execute:function(t){var n="<ul>";var r=p();if(r.location!=null){for(i in r){if(i!="_files"){n+="<li>"+r[i]+"</li>"}}}else{for(i in r){if(i!="_files"){n+="<li>"+i+"/</li>"}}if(r._files){for(i in r._files){if(i.substring(0,1)!="."||e.inArray("a",t.shortform)>=0){n+="<li>"+i+"</li>"}}}}n+="</ul>";return n},help:"lists all files and folders for your current directory"},help:{execute:function(){returnString="Here's a list of commands to use for this site: <ul>";for(i in h){returnString+="<li><span class='padleft'>"+i+"</span> : "+h[i].help+"</li>"}returnString+="</ul>";return returnString},help:"displays help for the system"},cd:{execute:function(e){if(e.target!="/"){if(e.target.charAt(e.target.length-1)=="/"){e.target=e.target.slice(0,-1)}var t=e.target.split("/");var r=e.target;var s=p();for(i in t){if(s[t[i]]){n.push(t[i]);s=s[t[i]]}else if(t[i]==".."){n.pop();s=p()}else{return"Oh no! Something went wonky!"}}}else{n=new Array}},help:"Changes the current directory the user is in"},touch:{execute:function(e){current=p();if(!current._files){current._files={}}current._files[e.target]={}},help:"Creates a file, or if the file exists, updates the files timestamp"},rm:{execute:function(e){current=p();delete current._files[e.target]},help:"Removes a file from the file tree"}};var p=function(){var e=a.fileSystem;for(i in n){e=e[n[i]]}return e};return this.each(function(){$this=e(this);$this.addClass("jqcmd").addClass(a.style);$this.append('<p id="first"><span class="static">'+a.hostname+'</span> > <span class="input"></span><span id="pointer"></span></p>');o=$this.children("#first").clone();$this.keydown(function(t){if(t.which==46){var n=e("#pointer").prev().text().slice(0,-1);e("#pointer").prev().text(n)}else if(t.which==9){t.preventDefault();c(e("#pointer").prev())}else if(t.which==8){t.preventDefault();var n=e("#pointer").prev().text().slice(0,-1);e("#pointer").prev().text(n)}else if(t.which==38){t.preventDefault();if(s<0){s=r.length-1}else if(s>0){s--}if(s>=0){e("#pointer").prev().text(r[s])}}else if(t.which==40){t.preventDefault();if(s>r.length-1){s=r.length-1}else if(s!=r.length-1){s++}if(s<=r.length-1){e("#pointer").prev().text(r[s])}}});$this.keypress(function(t){var r=null;if(window.event){r=window.event.keyCode}else if(t){r=t.which}if(r!=13&&t.ctrlKey==false){var s=String.fromCharCode(r);e("#pointer").prev().append(s)}else{var u=f(e("#pointer").prev().text());newLine=o.clone();if(u!="clearConsole"){var a=e(newLine).children(".static").text();for(i in n){if(n[i]!="root"){a+="/"+n[i]}e(newLine).children(".static").text(a)}if(u!=undefined){e("#pointer").parent().after("<div class='output'>"+u+"</div>");e("#pointer").remove();e(".output:last-child").after(newLine)}else{e("#pointer").parent().after(newLine);e("#pointer").remove()}}}$this.animate({scrollTop:$this[0].scrollHeight},"fast")})})}})(jQuery)